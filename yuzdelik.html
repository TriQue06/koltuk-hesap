<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oy Yüzdesi Hesaplayıcı</title>
  <style>
    @font-face{font-family:'Product Sans';src:url('font/ProductSans-Regular.ttf') format('truetype');font-weight:400;font-style:normal}
    *{font-family:'Product Sans',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
    button,input,select,textarea{font:inherit}

    /* Koyu Mod Varsayılan Değerleri (Kırmızı Dominant) */
    :root{
      --bg-color:#100508; /* Koyu Bordo Arkaplan */
      --card-bg:rgba(30,15,20,.92); /* Koyu Bordo Kart */
      --primary-color:#C70039; /* Kırmızı (Dominant Vurgu, Sonuçlar, Silme Butonu) */
      --secondary-color:#900C3F; /* BORDO (Butonlar, Fixed Link) */
      --tertiary-color:#FF5733; /* Turuncu (Gradient Stop) */
      --text-color:#fff0f0; --border-color:rgba(255,255,255,.15);
      --input-bg:rgba(255,255,255,.07); --result-bg:rgba(255,255,255,.05);
      --button-bg:#30181A; --button-hover-bg:#452A2C;
      --light-mode-secondary-text:#10121a;
    }

    /* Açık Mod Sınıfı */
    :root.light-mode{
      /* Değişkenler JS tarafından ayarlanır, burası sadece fallback/ek ayarlar için. */
    }

    body{
      background:var(--bg-color); color:var(--text-color);
      min-height:100vh; display:flex; justify-content:center;
      align-items:center;
      padding:20px; margin:0; transition:background-color .25s,color .25s
    }

    /* Üst Bar Stilleri */
    .top-bar{
      position:fixed; top:20px; left:20px; right:20px; z-index:1000;
      display:flex; justify-content:flex-start; align-items:center; gap:12px;
      pointer-events:none;
    }
    .top-left,.top-right{display:flex; align-items:center; gap:10px; pointer-events:auto}
    .top-btn{
      padding:10px 14px; border-radius:12px; background:var(--button-bg); color:var(--text-color);
      border:1px solid var(--border-color); font-size:1em; cursor:pointer; transition:background-color .25s, transform .15s;
      position:relative; z-index:1001; display:inline-flex; align-items:center; gap:8px;
    }
    .top-btn:hover{background:var(--button-hover-bg); transform:translateY(-1px)}
    .icon{
      width:20px; height:20px;
    }
    .btn-with-icon{display:inline-flex; align-items:center; gap:8px}

    .container{
      background:var(--card-bg); border-radius:20px; padding:32px; border:1px solid var(--border-color);
      box-shadow:0 8px 25px rgba(0,0,0,.1); width:100%; max-width:500px; animation:fadeIn .45s ease
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)}}

    h1{
      font-weight:700; text-align:center; font-size:2.5em; margin:0 0 24px;
      /* Gradient: Primary (Kırmızı) -> Tertiary (Bordo/Turuncu) */
      background:linear-gradient(45deg, var(--primary-color), var(--tertiary-color));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent
    }

    input[type="text"]{
      padding:12px; border:1px solid var(--border-color); border-radius:10px; background:var(--input-bg);
      color:var(--text-color); box-sizing:border-box; font-size:1em; transition:all .2s; width:100%;
    }
    input::placeholder{color:var(--text-color); opacity:.4}
    input:focus{outline:none; box-shadow:0 0 0 3px color-mix(in oklab, var(--primary-color) 35%, transparent); border-color:var(--primary-color)}

    .party-entry{margin-bottom:12px; display:flex; align-items:center; gap:10px}
    .party-name{flex:3}
    .party-votes{flex:1.5}

    .delete-btn{
      background:var(--primary-color); /* Kırmızı */
      color:var(--text-color);
      border:none; padding:8px 10px; border-radius:8px; width:38px; height:38px;
      display:flex; justify-content:center; align-items:center; cursor:pointer;
      transition:transform .15s, filter .2s;
    }
    .delete-btn:hover{
      transform:scale(1.05); filter:brightness(1.1);
    }
    /* Koyu temada ikonun rengini ters çevirerek beyaz yap */
    :root .delete-btn img {
        filter: invert(1);
    }
    /* Açık temada ikon rengini doğal bırak */
    :root.light-mode .delete-btn img {
        filter: invert(0);
    }


    .icon{width:16px; height:16px; vertical-align:middle;}
    .action-buttons{display:flex; gap:10px; margin-top:10px;}
    .action-buttons button{
      width:100%; background:var(--secondary-color); color:#fff; border:none; padding:12px; border-radius:10px;
      cursor:pointer; font-size:1em; font-weight:600; transition:transform .15s, filter .2s; display:flex; justify-content:center; align-items:center; gap:8px;
    }
    .action-buttons button:hover{transform:translateY(-1px); filter:brightness(1.05)}
    .action-buttons button img{filter: invert(1);} /* Koyu mod butonda beyaz ikon */
    :root.light-mode .action-buttons button img {
        filter: invert(0); /* Açık mod butonda siyah ikon */
    }
    :root.light-mode .action-buttons button {
        color: var(--light-mode-secondary-text);
    }


    .results{margin-top:20px; background:var(--result-bg); padding:16px; border-radius:12px; border:1px solid var(--border-color); box-shadow:0 2px 5px rgba(0,0,0,.05)}
    .results h2{
      margin:0 0 10px; font-size:1.5em; text-align:center;
      background:linear-gradient(45deg, var(--primary-color), var(--tertiary-color));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent
    }
    .results ul{list-style:none; padding:0; margin:0}
    .results li{
      background:var(--input-bg); padding:12px; border-radius:8px; margin-bottom:8px; display:flex;
      justify-content:space-between; align-items:center; transition:transform .1s; border-left:4px solid var(--primary-color);
      box-shadow:0 1px 3px rgba(0,0,0,.05);
    }
    .percentage{font-weight:700; font-size:1.1em; color:var(--primary-color)}
    .total-votes-display{text-align:center; opacity:.7; font-size:.9em; margin-top:10px}

    .github-button{
      position:fixed; bottom:20px; left:20px; padding:10px 14px; border-radius:10px; background:var(--button-bg);
      color:var(--text-color); border:1px solid var(--border-color); font-size:1em; cursor:pointer;
      transition:background-color .2s, transform .15s, box-shadow .2s; text-decoration:none; display:flex; align-items:center; gap:8px;
      z-index:999
    }
    .github-button:hover{background:var(--button-hover-bg); transform:translateY(-1px); box-shadow:0 2px 8px rgba(0,0,0,.2)}

    .fixed-link {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 15px;
      background: var(--secondary-color); /* BORDO */
      color: #fff;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: background-color .2s, transform .2s;
      z-index: 1000;
      font-size: 0.9em;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .fixed-link:hover {
      background: color-mix(in oklab, var(--secondary-color), #000 10%);
      transform: translateY(-2px);
    }
    .fixed-link img {filter: invert(1); width: 18px; height: 18px;}
  </style>
</head>
<body>

<div class="top-bar">
  <div class="top-left">
    <button id="themeButton" class="top-btn btn-with-icon" title="Tema">
      <img src="icon/theme.svg" alt="" class="icon" data-icon-name="theme"><span>Sistem Varsayılanı</span>
    </button>
  </div>
</div>

<a href="index.html" class="fixed-link">Koltuk Hesaplayıcı</a>

<div class="container">
  <h1>Oy Yüzdesi Hesaplayıcı</h1>

  <div id="main-container"></div>

  <div class="action-buttons">
    <button id="addPartyBtn">
      <img src="icon/add.svg" alt="Ekle" class="icon" data-icon-name="add">
      Parti Ekle
    </button>
  </div>

  <div id="output" class="results"></div>
</div>

<a href="https://github.com/TriQue06/koltuk-hesap" target="_blank" class="github-button btn-with-icon" rel="noopener">
  <img src="icon/github.svg" alt="GitHub" class="icon" data-icon-name="github">
  GitHub
</a>

<script>
  const THEME_LABELS = {
    system:'Sistem Varsayılanı', light:'Açık', dark:'Koyu',
  };

  const THEMES = [
    {key:"system", tone:"system", vars:{}},
    {key:"light", tone:"light", vars:{
      // Açık Mod: Bordo Dominant
      bg:"#ffffff", card:"#ffffff",
      pri:"#900C3F", // Bordo (Dominant Accent, Result Bar)
      sec:"#C70039", // Kırmızı (Button, Link)
      ter:"#FF5733", // Turuncu (Gradient Stop)
      text:"#10121a",
      border:"rgba(0,0,0,.15)",
      input:"#f5f5f5",
      result:"#f9f9f9",
      btn:"#e6e7ef", btnH:"#d8d9e6",
      light_mode_secondary_text:"#10121a"
    }},
    {key:"dark", tone:"dark", vars:{
      // Koyu Mod: Kırmızı Dominant, Butonlar Bordo
      bg:"#100508", card:"rgba(30,15,20,.92)",
      pri:"#C70039", // Kırmızı (Dominant Accent, Result Bar, Silme Butonu)
      sec:"#900C3F", // BORDO (Button, Link)
      ter:"#FF5733", // Turuncu (Gradient Stop)
      text:"#fff0f0",
      border:"rgba(255,255,255,.15)",
      input:"rgba(255,255,255,.07)",
      result:"rgba(255,255,255,.05)",
      btn:"#30181A", btnH:"#452A2C",
      light_mode_secondary_text:"#10121a"
    }},
  ];

  let themeIndex = 0;
  const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)');

  function getSystemThemeColors(){
    const isDark = prefersDark?.matches;
    const key = isDark ? 'dark' : 'light';
    const systemTheme = THEMES.find(t => t.key === key);
    return systemTheme ? systemTheme.vars : THEMES.find(t => t.key === 'dark').vars;
  }

  function setCSSVars(vars){
    const r=document.documentElement.style;
    r.setProperty('--bg-color', vars.bg);
    r.setProperty('--card-bg', vars.card);
    r.setProperty('--primary-color', vars.pri);
    r.setProperty('--secondary-color', vars.sec);
    r.setProperty('--tertiary-color', vars.ter);
    r.setProperty('--text-color', vars.text);
    r.setProperty('--border-color', vars.border);
    r.setProperty('--input-bg', vars.input);
    r.setProperty('--result-bg', vars.result);
    r.setProperty('--button-bg', vars.btn);
    r.setProperty('--button-hover-bg', vars.btnH);
    r.setProperty('--light-mode-secondary-text', vars.light_mode_secondary_text || '#10121a');
  }

  function updateIcons(isLightMode) {
    const iconPath = `icon/`;
    const themeSuffix = isLightMode ? '-light.svg' : '.svg';
    document.querySelectorAll('.icon').forEach(icon => {
      const iconName = icon.dataset.iconName;
      if (iconName && iconName !== 'theme') {
        icon.src = `${iconPath}${iconName}${themeSuffix}`;
      }
    });
  }

  function applyThemeByIndex(idx){
    const t = THEMES[(idx+THEMES.length)%THEMES.length];
    let finalVars = t.vars;
    let currentTone = t.tone;

    if (t.key === 'system') {
      finalVars = getSystemThemeColors();
      const isSystemDark = prefersDark?.matches;
      currentTone = isSystemDark ? 'dark' : 'light';
    }

    setCSSVars(finalVars);

    const isLightMode = currentTone === 'light';
    document.documentElement.classList.toggle('light-mode', isLightMode);

    updateIcons(isLightMode);
    document.getElementById('themeButton').querySelector('span').textContent = THEME_LABELS[t.key] || t.key;
    calculate();
  }

  const $ = sel => document.querySelector(sel);
  const mainContainer = $('#main-container');

  function parseVoteValue(v){
    if(typeof v==='string'){
      v=v.replace(/[\.,]/g,'');
      v=v.replace(/[^0-9]/g,'');
    }
    return parseInt(v) || 0;
  }

  function addParty(name='', votes=''){
    const div = document.createElement('div');
    div.className = 'party-entry';
    div.dataset.type = 'party';

    div.innerHTML = `
      <input type="text" placeholder="Parti Adı" value="${name}" class="party-name">
      <input type="text" placeholder="Oy Sayısı" value="${votes.toLocaleString('tr-TR')}" class="party-votes" inputmode="numeric">
      <button type="button" class="delete-btn" title="Kaldır">
        <img src="icon/remove.svg" alt="Kaldır" class="icon" data-icon-name="remove">
      </button>
    `;

    div.querySelectorAll('input').forEach(i => {
      i.addEventListener('input', calculate);
      if (i.classList.contains('party-votes')) {
        i.addEventListener('focus', () => i.value = parseVoteValue(i.value) || '');
        i.addEventListener('blur', () => i.value = parseVoteValue(i.value).toLocaleString('tr-TR'));
      }
    });
    div.querySelector('.delete-btn').addEventListener('click', () => { div.remove(); calculate(); });

    mainContainer.appendChild(div);
    applyThemeByIndex(themeIndex);
    calculate();
  }

  function calculate(){
    const allEntries = Array.from(document.querySelectorAll('.party-entry'));
    const totalVotes = allEntries.reduce((sum, entry) => {
      const votes = parseVoteValue(entry.querySelector('.party-votes').value);
      return sum + votes;
    }, 0);

    const outputDiv = $('#output');
    if(totalVotes === 0 || allEntries.length === 0){
      outputDiv.innerHTML = '<p class="total-votes-display">Lütfen parti ekleyip oy sayılarını girin.</p>';
      return;
    }

    const results = [];

    allEntries.forEach(entry => {
      const name = entry.querySelector('.party-name').value.trim() || 'Parti';
      const votes = parseVoteValue(entry.querySelector('.party-votes').value);

      if (votes > 0) {
        const percentage = ((votes / totalVotes) * 100).toFixed(2);
        results.push({ name, votes, percentage });
      }
    });

    results.sort((a, b) => b.votes - a.votes);

    let out = '<h2>Yüzdelik Dağılım</h2><ul>';

    for (const r of results) {
      out += `<li>
                <div><strong>${r.name}</strong></div>
                <span class="percentage">${r.percentage}%</span>
              </li>`;
    }

    out += '</ul>';
    out += `<div class="total-votes-display">Toplam Geçerli Oy: ${totalVotes.toLocaleString('tr-TR')}</div>`;
    outputDiv.innerHTML = out;
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('addPartyBtn').addEventListener('click', () => addParty());

    document.getElementById('themeButton').addEventListener('click',()=>{
      themeIndex=(themeIndex+1)%THEMES.length;
      applyThemeByIndex(themeIndex);
    });

    applyThemeByIndex(themeIndex);
    calculate();
  });
</script>
</body>
</html>